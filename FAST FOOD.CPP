

#include<fstream.h>
#include<conio.h>
#include<stdio.h>
#include<string.h>
#include<dos.h>

class Food
{
	int code;
	char item[15];
	int price;
	int qty;
	int rol;
	public:
	void addItem();
	void delItem();
	void itemList();
	void stockInHand();
	void stockMng();
	void updateQty(int code, int qty);
	Food searchDetails(int code, int &found);
	int retCode() {return code;}
	char* retItem()	{	return item;}
	int retPrice()	{	return price;}
	int retQty()	{	return qty;}
	void deductQty(int code, int qty);
};

class Bills
{
	int bcode;
	char bitem[15];
	int bprice;
	int bqty;
	long amt;
	public:
	void raiseBill();
	void totalSale();
};

void drawBox(int x1, int y1, int x2, int y2, int line);
void aboutProject();
void codeMngScreen();
void reportMngScreen();
void action(int row);
char masterFile[]="master.dat";
char transFile[]="trans.dat";

void main()
{
	clrscr();

	int choice;
	Bills b;
	Food f;
//	fstream fout1(masterFile, ios::binary | ios::out);
//	fout1.close();
//	fstream fout2(transFile, ios::binary | ios::out);
//	fout2.close();

	do
	{
		clrscr();
		gotoxy(22,2);	cout<<"T H E   A M E R I C A N   D H A B B A";
		drawBox(18,3,62,16,1);
		gotoxy(29,4);		cout<<"O P E N I N G   M E N U";
		gotoxy(30,7);		cout<<"1. About the project";
		gotoxy(30,8);		cout<<"2. Code Management";
		gotoxy(30,9);		cout<<"3. Stock Entery";
		gotoxy(30,10);	cout<<"4. Invoicing";
		gotoxy(30,11);	cout<<"5. Reports";
		gotoxy(30,12);	cout<<"0. Exit";
		gotoxy(30,14);	cout<<"Enter your choice : ";
		cin>>choice;
		switch(choice)
		{
			case 1: aboutProject();
							break;

			case 2: codeMngScreen();
							break;

			case 3: f.stockMng();
							break;

			case 4: b.raiseBill();
							break;

			case 5: reportMngScreen();
							break;
		}
	}while(choice!=0);
}

void drawBox(int x1, int y1, int x2, int y2, int line)
{
	char hr=205,vr=186,c1=201,c2=187,c3=204,c4=185,c5=200,c6=188;
	int r,c;
	for(c=x1; c<x2; c++)
	{
		gotoxy(c,y1);
		cout<<hr;
		if(line==1)
		{
			gotoxy(c,y1+2);
			cout<<hr;
		}
		gotoxy(c,y2);
		cout<<hr;
	}

	for(r=y1; r<y2; r++)
	{
		gotoxy(x1,r);
		cout<<vr;
		gotoxy(x2,r);
		cout<<vr;
	}
	gotoxy(x1,y1);
	cout<<c1;

	gotoxy(x2,y1);
	cout<<c2;

	if(line==1)
	{
		gotoxy(x1,y1+2);
		cout<<c3;

		gotoxy(x2,y1+2);
		cout<<c4;
	}

	gotoxy(x1,y2);
	cout<<c5;

	gotoxy(x2,y2);
	cout<<c6;
}

void aboutProject()
{
	clrscr();
	gotoxy(32,3);	cout<<"About the Project";
	drawBox(2,4,78,24,0);

	gotoxy(8,6);
	cout<<"This project is about automating a fast food restaurant. Initially";
	gotoxy(8,7);
	cout<<"after installing the project we need to generate the item codes of";
	gotoxy(8,8);
	cout<<"the items to be sold in the restaurant.The codes are automatically";
	gotoxy(8,9);
	cout<<"generated by the system which reduces the risk of duplicate codes.";
	gotoxy(8,10);
	cout<<"Once the codes are generated,  we add the stock to be  kept in the";
	gotoxy(8,11);
	cout<<"restaurant. After the items are added in the stock, now the system";
	gotoxy(8,12);
	cout<<"is ready to raise the bills. While  raising the bills,  the system";
	gotoxy(8,13);
	cout<<"automatically deducts the sold quantity from the stock.  Hence the";
	gotoxy(8,14);
	cout<<"system keeps a track of the inventory also.  As far as reports are";
	gotoxy(8,15);
	cout<<"concerned,one can see item list, stock in hand and the total sales";
	gotoxy(8,16);
	cout<<"of the restaurant till date.  The programme is  self-sufficient to";
	gotoxy(8,17);
	cout<<"keep a track of inventory and the amount to be collected.";

	gotoxy(35,19);
	cout<<"Made by:";
	gotoxy(32,20);
	cout<<"SAATWIK BISARIA";
	gotoxy(34,21);
	gotoxy(32,22);
	cout<<"class: 12th-C";

	gotoxy(28,25);
	cout<<"<press any key to continue!!!>";
	getch();
}

void codeMngScreen()
{
	Food f;
	int choice;

	do
	{
		clrscr();
		drawBox(15,3,65,13,1);
		gotoxy(19,4);		cout<<"C O D E   M A N A G E M E N T   S C R E E N";
		gotoxy(20,7);		cout<<"1. Add new code";
		gotoxy(20,8);		cout<<"2. Delete code";
		gotoxy(20,9);		cout<<"0. Back";
		gotoxy(20,11);	cout<<"Enter your choice : ";
		cin>>choice;
		switch(choice)
		{
			case 1: f.addItem();
							break;

			case 2: f.delItem();
							break;
		}
	}while(choice!=0);
}

void Food::stockMng()
{
	int SNO=1, row=7,QTY;
	Food fd;

	clrscr();
	gotoxy(26,2);		cout<<"S T O C K   M A N A G E M E N T";
	gotoxy(15,4);		cout<<"S.No   Code   Description       Old   Add   Present";
	gotoxy(15,5);		cout<<"                                Qty   Qty     Qty";
	drawBox(12,6,68,6,0);
	drawBox(12,3,68,24,0);

	fstream f1(masterFile, ios::binary | ios::in | ios::out);

	while(f1.read((char*)&fd, sizeof(fd)))
	{
		if(fd.qty < fd.rol)
		{
			gotoxy(15,row);	cout<<SNO<<".";
			gotoxy(23,row);	cout<<fd.code;
			gotoxy(29,row);	cout<<fd.item;
			gotoxy(47,row);	cout<<fd.qty;
			gotoxy(53,row);	cin>>QTY;
			int new_qty=fd.qty+QTY;
			gotoxy(61,row);	cout<<new_qty;
			updateQty(fd.code, new_qty);
			SNO++;
			row++;
		}
	}

	f1.close();

	getch();
}

void Food::updateQty(int Code, int Qty)
{
	Food f;
	fstream f1(masterFile, ios::binary | ios::in | ios::out);

	while(f1.read((char*)&f, sizeof(f)))
	{
		if(f.code==Code)
		{
			int n=-sizeof(f);
			f1.seekp(n, ios::cur);
			f.qty=Qty;
			f1.write((char*)&f, sizeof(f));
		}
	}
	f1.close();
}

void reportMngScreen()
{
	Food f;
	Bills b;
	int choice;

	do
	{
		clrscr();
		drawBox(20,3,60,14,1);
		gotoxy(34,4);		cout<<"R E P O R T S";
		gotoxy(28,7);		cout<<"1. Item list";
		gotoxy(28,8);		cout<<"2. Stock in Hand";
		gotoxy(28,9);		cout<<"3. Total Sale";
		gotoxy(28,10);	cout<<"0. Back";
		gotoxy(28,12);	cout<<"Enter your choice : ";
		cin>>choice;
		switch(choice)
		{
			case 1: f.itemList();
							break;
			case 2: f.stockInHand();
							break;
			case 3: b.totalSale();
							break;
		}
	}while(choice!=0);
}

void Food::addItem()
{
	int choice,CODE=99, PRICE, QTY, ROL;
	char ITEM[15],yn,MORE;

	Food fd;
	fstream fin(masterFile, ios::binary | ios::in);

	while(fin.read((char*)&fd, sizeof(fd)))
	{
		CODE=fd.code;
	}

	fin.close();

	do
	{
		clrscr();
		drawBox(20,3,60,12,1);
		gotoxy(29,4);		cout<<"A D D   N E W   I T E M";
		gotoxy(24,7);		cout<<"New Code is : "<<CODE+1;
		gotoxy(24,8);		cout<<"Enter Desc. : ";
		gets(ITEM);
		gotoxy(24,9);		cout<<"Enter Price : ";
		cin>>PRICE;
		gotoxy(24,10);	cout<<"Enter R/O/L : ";
		cin>>ROL;
		gotoxy(26,14);	cout<<"Do you want to SAVE it(y/n)? ";
		cin>>yn;

		if(yn=='y' || yn=='Y')
		{
			Food f;
			CODE++;
			f.code=CODE;
			strcpy(f.item, ITEM);
			f.price=PRICE;
			f.qty=0;
			f.rol=ROL;
			fstream fout(masterFile, ios::binary | ios::app);
			fout.write((char*)&f, sizeof(f));
			fout.close();
		}

		gotoxy(22,15);		cout<<"Do you want to Enter More records(y/n)? ";
		cin>>MORE;
	}while(MORE=='y' || MORE=='Y');
}

void Food::itemList()
{
	int row=5;
	Food f;
	fstream fin(masterFile, ios::binary | ios::in);

	clrscr();
	gotoxy(28,1);		cout<<"L I S T   O F   I T E M S";
	drawBox(22,2,58,22,1);
	gotoxy(25,3);		cout<<"Code  Item                  Price" ;
	while(fin.read((char*)&f, sizeof(f)))
	{
		gotoxy(25,row);		cout<<f.code;
		gotoxy(32,row);		cout<<f.item;
		gotoxy(52,row);		cout<<f.price;
		row++;
	}
	gotoxy(25,23);		cout<<"<press any key to continue!!!>";
	getch();
}

void Food::stockInHand()
{
	int row=5;
	Food f;
	fstream fin(masterFile, ios::binary | ios::in);

	clrscr();
	gotoxy(28,1);		cout<<"S T O C K   I N   H A N D";
	drawBox(22,2,58,22,1);
	gotoxy(25,3);		cout<<"Code  Item                Qty" ;
	while(fin.read((char*)&f, sizeof(f)))
	{
		gotoxy(25,row);		cout<<f.code;
		gotoxy(31,row);		cout<<f.item;
		gotoxy(51,row);		cout<<f.qty;
		row++;
	}
	gotoxy(25,23);		cout<<"<press any key to continue!!!>";
	getch();
}

void Bills::totalSale()
{
	clrscr();
	long amount=0;
	Bills b;
	fstream fin(transFile, ios::binary | ios::in);

	while(fin.read((char*)&b, sizeof(b)))
		amount+=b.amt;

	drawBox(22,5,68,9,0);
	gotoxy(30,7);		cout<<"T O T A L  S A L E S = Rs."<<amount<<"/-";

	fin.close();
	getch();
}

void Food::delItem()
{
	Food f;
	char yn;
	int CODE,found=0;
	clrscr();
	drawBox(25,5,65,11,0);
	gotoxy(30,7); 	cout<<"Enter code to be deleted :";
	cin>>CODE;

	fstream fin(masterFile, ios::binary | ios::in);
	fstream fout("temp", ios::binary | ios::out);

	while(fin.read((char*)&f, sizeof(f)))
	{
		if(CODE!=f.code)
			fout.write((char*)&f, sizeof(f));
		else
		{
			found=1;
			gotoxy(30,8); cout<<"Item description :"<<f.item;
			gotoxy(30,9); cout<<"Do you want to delete it(y/n)? :";
			cin>>yn;
			if(yn=='y' || yn=='Y')
			{
				gotoxy(36,12);
				cout<<"Record deleted!!!";
				getch();
			}
			else
				fout.write((char*)&f, sizeof(f));
		}
	}

	if(found==0)
	{
		gotoxy(34,12);
		cout<<"Record not found!!!";
	}

	fin.close();
	fout.close();
	remove(masterFile);
	rename("temp",masterFile);
}

void Bills::raiseBill()
{
	char yn;
	int BNO=1,SNO=1,row=8,CODE,qt,pr,Amt,grTot=0,found;
	clrscr();
	gotoxy(31,2);	cout<<"I N V O I C I N G";
	gotoxy(13,4);	cout<<"Bill No :"<<BNO;
	gotoxy(15,6);	cout<<"S.No  Code    Descripton      U.Price  Qty  Amount" ;
	drawBox(19,7,19,20,0); // vrt. line-1
	drawBox(24,7,24,20,0); // vrt. line-2
	drawBox(44,7,44,20,0); // vrt. line-3
	drawBox(52,7,52,20,0); // vrt. line-4
	drawBox(58,7,58,22,0); // vrt. line-5
	drawBox(13,7,67,7,0);  // hoz. line-1
	drawBox(13,20,67,20,0); // hoz. line-2
	gotoxy(45,21);	cout<<"G. Total : ";
	drawBox(13,5,67,22,0); // main Box

	Bills b[10];
	Food f;
	int n=0;

	gotoxy(27,24); cout<<"Enter '0' to terminate Bill";
	do
	{
		gotoxy(15,row);	cout<<SNO<<".";
		gotoxy(21,row);	cin>>CODE;

		fstream fin(masterFile, ios::binary | ios::in);
		found=0;
		while(fin.read((char*)&f, sizeof(f)))
		{
			if(CODE==f.retCode())
			{
				found=1;

				gotoxy(27,23);	clreol();
				gotoxy(27,23);	cout<<"      Qty. in Stock :"<<f.retQty();
				gotoxy(27,row);	cout<<f.retItem();
				pr=f.retPrice();
				gotoxy(47,row);	cout<<pr;
				gotoxy(55,row);	cin>>qt;
				Amt=pr*qt;
				gotoxy(61,row);	cout<<Amt;
				grTot=grTot+Amt;
				gotoxy(61,21);	cout<<grTot;

				b[n].bcode=CODE;
				strcpy(b[n].bitem,f.retItem());
				b[n].bprice=pr;
				b[n].bqty=qt;
				b[n].amt=Amt;
				n++;

				SNO++;
				row++;
			}
		}

		if(found==0)
		{
			if(CODE!=0)
			{
				gotoxy(27,23);	clreol();
				gotoxy(27,23); cout<<"    Code doesn't exists !!!       ";
			}
			getch();
			gotoxy(22,row); cout<<"  ";
		}
	}while(CODE!=0);

	gotoxy(15,row);	cout<<"  ";
	gotoxy(20,row);	cout<<"  ";

	gotoxy(24,23);	clreol();
	gotoxy(24,23);  cout<<"Do you want to SAVE this bill(y/n)?:";
	cin>>yn;

	if(yn=='y'||yn=='Y')
	{
		gotoxy(27,24); clreol();
		gotoxy(1,23);
		clreol();
		action(23);
		gotoxy(1,23);
		clreol();
		gotoxy(1,24);
		clreol();

		Food ff;
		fstream fout(transFile, ios::binary | ios::app);

		for(int i=0; i<n; i++)
		{
			fout.write((char*)&b[i], sizeof(b[i]));
			ff.deductQty(b[i].bcode, b[i].bqty);
		}

		fout.close();
	}

	getch();
}

void Food::deductQty(int CD, int QTY)
{
	Food f;

	fstream f1(masterFile, ios::binary | ios::in | ios::out);
	while(f1.read((char*)&f, sizeof(f)))
	{
		if(CD==f.code)
		{
			int n=-sizeof(Food);
			f1.seekp(n,ios::cur);
			f.qty=f.qty-QTY;
			f1.write((char*)&f, sizeof(f));
		}
	}

	f1.close();
}

Food Food::searchDetails(int CODE, int &found)
{
	Food f;
	found=0;
	fstream fin(masterFile, ios::binary | ios::in);
	while(fin.read((char*)&f, sizeof(f)))
	{
		if(CODE==f.code)
		{
			found=1;
			return f;
		}
	}

	fin.close();
	return f;
}

void action(int row)
{
	char ch=222;
	gotoxy(33,row+1);
	cout<<"Proccess ......";
	for(int i=30; i<=50; i++)
	{
		sound(250);
		gotoxy(i,row);
		cout<<ch;
		delay(80);
		nosound();
		delay(10);
	}
}

